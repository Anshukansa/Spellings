<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spelling Practice Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    h1, h2 {
      color: #333;
    }
    .container {
      background: #fff;
      border: 1px solid #ccc;
      padding: 16px;
      margin-bottom: 20px;
    }
    button {
      padding: 8px 16px;
      margin: 6px 0;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    button:hover {
      background-color: #eaeaea;
    }
    input[type="text"] {
      padding: 8px;
      margin: 6px 0;
      width: 280px;
    }
    select {
      padding: 8px;
      margin: 6px 0;
    }
    #game-container,
    #result-container,
    #list-manager {
      display: none;
    }
    .message {
      margin-top: 10px;
      padding: 8px;
    }
    .correct {
      background-color: #d8ffd8;
      color: green;
    }
    .incorrect {
      background-color: #ffd8d8;
      color: red;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    .list-item {
      margin: 4px 0;
    }
    .list-item button {
      margin-left: 10px;
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <h1>Spelling Practice Game</h1>

  <!-- ========== HOME / START CONTAINER ========== -->
  <div id="start-container" class="container">
    <h2>1. Create or Resume a Game</h2>
    <div>
      <label>Enter Words (comma-separated):</label><br>
      <input type="text" id="words-input" placeholder="e.g., apple, banana, cat">
    </div>
    <div>
      <label>Select Mode:</label><br>
      <select id="mode-select">
        <option value="in-line">In-Line (sequential)</option>
        <option value="random">Random</option>
      </select>
    </div>
    <button id="new-game-btn">Start New Game</button>
    <button id="resume-game-btn">Resume Game</button>
    <button id="manage-list-btn">Manage Current List</button>
  </div>

  <!-- ========== LIST MANAGER ========== -->
  <div id="list-manager" class="container">
    <h2>Manage Current Word List</h2>
    <p>Below are the words currently in your practice list.</p>
    <ul id="current-word-list"></ul>
    
    <h3>Add a new word</h3>
    <input type="text" id="add-word-input" placeholder="Type a new word">
    <button id="add-word-btn">Add Word</button><br><br>
    
    <button id="close-list-btn">Close</button>
  </div>

  <!-- ========== GAME CONTAINER ========== -->
  <div id="game-container" class="container">
    <p><strong>Spell (spoken) word:</strong></p>
    <input type="text" id="user-spelling" placeholder="Type the spelling">
    <button id="check-btn">Check</button>
    <p id="feedback" class="message"></p>
    <p>Score: <span id="score-display">0</span></p>
    <button id="quit-btn">Quit Game</button>
  </div>

  <!-- ========== RESULT CONTAINER ========== -->
  <div id="result-container" class="container">
    <h2>Game Over</h2>
    <p>Your final score is: <span id="final-score"></span></p>
    <button id="restart-btn">Restart</button>
  </div>

  <script>
    /********************************************************
     *                GLOBAL / STATE VARIABLES
     ********************************************************/
    const STORAGE_KEY = 'spellingGameState'; // localStorage key

    // We'll maintain our game state in an object:
    let gameState = {
      words: [],           // current list of words
      mode: 'in-line',     // 'in-line' or 'random'
      currentIndex: 0,     // next word index (for in-line)
      usedIndices: [],     // used words in 'random' mode to avoid repeats
      score: 0,
      isGameActive: false, // are we in the middle of a game?
    };

    /********************************************************
     *                    ELEMENT REFERENCES
     ********************************************************/
    const startContainer   = document.getElementById('start-container');
    const wordsInput       = document.getElementById('words-input');
    const modeSelect       = document.getElementById('mode-select');
    const newGameBtn       = document.getElementById('new-game-btn');
    const resumeGameBtn    = document.getElementById('resume-game-btn');
    const manageListBtn    = document.getElementById('manage-list-btn');
    
    const listManager      = document.getElementById('list-manager');
    const currentWordList  = document.getElementById('current-word-list');
    const addWordInput     = document.getElementById('add-word-input');
    const addWordBtn       = document.getElementById('add-word-btn');
    const closeListBtn     = document.getElementById('close-list-btn');

    const gameContainer    = document.getElementById('game-container');
    const userSpelling     = document.getElementById('user-spelling');
    const checkBtn         = document.getElementById('check-btn');
    const feedback         = document.getElementById('feedback');
    const scoreDisplay     = document.getElementById('score-display');
    const quitBtn          = document.getElementById('quit-btn');
    
    const resultContainer  = document.getElementById('result-container');
    const finalScore       = document.getElementById('final-score');
    const restartBtn       = document.getElementById('restart-btn');

    /********************************************************
     *                      ON LOAD
     ********************************************************/
    // On page load, try to load existing gameState from localStorage
    document.addEventListener('DOMContentLoaded', () => {
      loadGameState();
      updateResumeButtonVisibility();
      renderCurrentWordList();
    });

    /********************************************************
     *                   EVENT LISTENERS
     ********************************************************/
    newGameBtn.addEventListener('click', startNewGame);
    resumeGameBtn.addEventListener('click', resumeGame);
    manageListBtn.addEventListener('click', openListManager);

    addWordBtn.addEventListener('click', addWordToList);
    closeListBtn.addEventListener('click', closeListManager);

    checkBtn.addEventListener('click', checkSpelling);
    quitBtn.addEventListener('click', quitGame);
    restartBtn.addEventListener('click', restart);

    /********************************************************
     *                  LOCAL STORAGE HANDLING
     ********************************************************/
    function saveGameState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
    }

    function loadGameState() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        gameState = JSON.parse(stored);
      }
    }

    /********************************************************
     *             START / RESUME / RESTART GAME
     ********************************************************/
    function startNewGame() {
      const inputVal = wordsInput.value.trim();
      if (!inputVal) {
        alert('Please enter some words (comma-separated)!');
        return;
      }
      let newWords = inputVal.split(',').map(w => w.trim()).filter(Boolean);
      if (newWords.length === 0) {
        alert('No valid words found. Please try again.');
        return;
      }
      // Initialize fresh game state
      gameState.words = newWords;
      gameState.mode = modeSelect.value;
      gameState.currentIndex = 0;
      gameState.usedIndices = [];
      gameState.score = 0;
      gameState.isGameActive = true;

      // Save & start
      saveGameState();
      launchGame();
    }

    function resumeGame() {
      if (!gameState.isGameActive) {
        alert('No active game found to resume!');
        return;
      }
      launchGame();
    }

    function restart() {
      // Clear final screen, return to start
      resultContainer.style.display = 'none';
      startContainer.style.display = 'block';
    }

    function launchGame() {
      // Hide start container, show game container
      startContainer.style.display = 'none';
      listManager.style.display = 'none';
      resultContainer.style.display = 'none';
      gameContainer.style.display = 'block';

      // Update score UI
      scoreDisplay.textContent = gameState.score;
      feedback.textContent = '';

      // Prompt the user with the next spelling (spoken only)
      speakNextWord();
    }

    function updateResumeButtonVisibility() {
      // Show "Resume Game" only if isGameActive is true
      if (gameState.isGameActive) {
        resumeGameBtn.style.display = 'inline-block';
      } else {
        resumeGameBtn.style.display = 'none';
      }
    }

    /********************************************************
     *                  LIST MANAGER
     ********************************************************/
    function openListManager() {
      // Render the current words
      renderCurrentWordList();
      // Show the manager
      startContainer.style.display = 'none';
      listManager.style.display = 'block';
      gameContainer.style.display = 'none';
      resultContainer.style.display = 'none';
    }

    function closeListManager() {
      listManager.style.display = 'none';
      // If the game is active, return to game screen
      // otherwise return to start screen
      if (gameState.isGameActive && gameContainer.style.display === 'block') {
        gameContainer.style.display = 'block';
      } else {
        startContainer.style.display = 'block';
      }
    }

    function renderCurrentWordList() {
      currentWordList.innerHTML = '';
      // We'll use gameState.words to populate
      gameState.words.forEach((word, index) => {
        const li = document.createElement('li');
        li.classList.add('list-item');
        li.textContent = word;
        
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', () => removeWordFromList(index));
        
        li.appendChild(removeBtn);
        currentWordList.appendChild(li);
      });
    }

    function addWordToList() {
      const newWord = addWordInput.value.trim();
      if (newWord) {
        gameState.words.push(newWord);
        saveGameState();
        renderCurrentWordList();
      }
      addWordInput.value = '';
    }

    function removeWordFromList(index) {
      gameState.words.splice(index, 1);
      // If we remove the word in the middle of a game, it might affect random mode or indexing
      // but we’ll keep it simple: the code will adapt on next pick.
      saveGameState();
      renderCurrentWordList();
    }

    /********************************************************
     *                GAME LOGIC & FUNCTIONS
     ********************************************************/
    // 1. Speak the next word (do not display it)
    function speakNextWord() {
      if (!gameState.words || gameState.words.length === 0) {
        // No words to speak => End game
        endGame();
        return;
      }

      if (gameState.mode === 'in-line') {
        // If in-line mode, check if currentIndex is out of range
        if (gameState.currentIndex >= gameState.words.length) {
          endGame();
          return;
        }
        const word = gameState.words[gameState.currentIndex];
        speakWord(word);
      } else {
        // Random mode
        if (gameState.usedIndices.length === gameState.words.length) {
          // All words used => end game
          endGame();
          return;
        }
        let randomIndex;
        do {
          randomIndex = Math.floor(Math.random() * gameState.words.length);
        } while (gameState.usedIndices.includes(randomIndex));
        gameState.usedIndices.push(randomIndex);
        saveGameState();

        const word = gameState.words[randomIndex];
        speakWord(word);
      }
    }

    // 2. Text-to-speech
    function speakWord(word) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(word);
        speechSynthesis.speak(utterance);
      }
    }

    // 3. Check the user’s spelling
    function checkSpelling() {
      const userAnswer = userSpelling.value.trim();
      userSpelling.value = '';

      let correctWord = '';
      if (gameState.mode === 'in-line') {
        correctWord = gameState.words[gameState.currentIndex];
      } else {
        // Random mode => last used index is the last element of usedIndices
        const lastIndex = gameState.usedIndices[gameState.usedIndices.length - 1];
        correctWord = gameState.words[lastIndex];
      }

      if (!userAnswer) {
        feedback.textContent = 'Please type the spelling.';
        feedback.className = 'message';
        return;
      }

      if (userAnswer.toLowerCase() === correctWord.toLowerCase()) {
        // Correct
        gameState.score++;
        feedback.textContent = `Correct! The spelling is "${correctWord}".`;
        feedback.className = 'message correct';
      } else {
        // Incorrect
        feedback.textContent = `Incorrect! The correct spelling is "${correctWord}".`;
        feedback.className = 'message incorrect';
      }

      // Update index if in-line
      if (gameState.mode === 'in-line') {
        gameState.currentIndex++;
      }
      
      // Update score display & save
      scoreDisplay.textContent = gameState.score;
      saveGameState();

      // Move to next word after a short delay
      setTimeout(() => {
        feedback.textContent = '';
        speakNextWord();
      }, 1500);
    }

    // 4. Quit game
    function quitGame() {
      if (confirm('Are you sure you want to quit?')) {
        endGame();
      }
    }

    // 5. End game
    function endGame() {
      gameState.isGameActive = false;
      saveGameState();

      // Hide game container, show results
      gameContainer.style.display = 'none';
      resultContainer.style.display = 'block';
      finalScore.textContent = gameState.score;
      
      // Refresh the resume button visibility
      updateResumeButtonVisibility();
    }
  </script>
</body>
</html>
